'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _crypto=require('crypto');var _crypto2=_interopRequireDefault(_crypto);var _querystring=require('querystring');var _querystring2=_interopRequireDefault(_querystring);var _config=require('./config');var _util=require('./util');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var top_list=[['\u4E91\u97F3\u4E50\u98D9\u5347\u699C',19723756],['\u4E91\u97F3\u4E50\u65B0\u6B4C\u699C',3779629],['\u7F51\u6613\u539F\u521B\u6B4C\u66F2\u699C',2884035],['\u4E91\u97F3\u4E50\u70ED\u6B4C\u699C',3778678],['\u4E91\u97F3\u4E50\u7535\u97F3\u699C',10520166],['UK\u6392\u884C\u699C\u5468\u699C',180106],['\u7F8E\u56FDBillboard\u5468\u699C',60198],['KTV\u55E8\u699C',21845217],['iTunes\u699C',11641012],['Hit FM Top\u699C',120001],['\u65E5\u672COricon\u5468\u699C',60131],['\u97E9\u56FDMelon\u6392\u884C\u699C\u5468\u699C',3733003],['\u97E9\u56FDMnet\u6392\u884C\u699C\u5468\u699C',60255],['\u97E9\u56FDMelon\u539F\u58F0\u5468\u699C',46772709],['\u4E2D\u56FDTOP\u6392\u884C\u699C(\u6E2F\u53F0\u699C)',112504],['\u4E2D\u56FDTOP\u6392\u884C\u699C(\u5185\u5730\u699C)',64016],['\u9999\u6E2F\u7535\u53F0\u4E2D\u6587\u6B4C\u66F2\u9F99\u864E\u699C',10169002],['\u534E\u8BED\u91D1\u66F2\u699C',4395559],['\u4E2D\u56FD\u563B\u54C8\u699C',1899724],['\u6CD5\u56FD NRJ EuroHot 30\u5468\u699C',27135204],['\u53F0\u6E7EHito\u6392\u884C\u699C',112463],['Beatport\u5168\u7403\u7535\u5B50\u821E\u66F2\u699C',3812895]];var getTopListNames=function getTopListNames(){return top_list.map(function(l,i){return' '+i+'. '+l[0]})};var getTopSongList=function getTopSongList(){var index=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var option=(0,_util.deepCopy)(_config.globalOption);var url=_config.origin+'/discover/toplist?id='+top_list[index][1];var body=(0,_util.requestGetRaw)(url,option);var re=new RegExp(/>\[.*\]</);return JSON.parse(body.match(re)[0].slice(1,-1))};var song=function song(id){var option=(0,_util.deepCopy)(_config.globalOption);var url=_config.origin+'/api/song/detail?ids=%5B'+id+'%5d';return(0,_util.requestGet)(url,option).songs[0]};function str2ta(str){var buf=new ArrayBuffer(str.length);var bufView=new Uint8Array(buf);str.split('').map(function(s,i){bufView[i]=s.charCodeAt()});return bufView}var encodeId=function encodeId(dfsId){var a1=str2ta('3go8&$8*3*3h0k(2)2'),a2=str2ta(dfsId),a1l=a1.length;a2.map(function(c,i){a2[i]=c^a1[i%a1l]});var m=_crypto2.default.createHash('md5');m.update(a2);return m.digest().toString('base64').replace(/\//g,'_').replace(/\+/g,'-')};var getMp3Url=function getMp3Url(song){var music={};if(song.hMusic){music=song.hMusic}else if(song.mMusic){music=song.mMusic}else{return song.mp3Url}var song_id=music.dfsId.toString();var enc_id=encodeId(song_id);return'http://m2.music.126.net/'+enc_id+'/'+song_id+'.mp3'};var getMp3UrlById=function getMp3UrlById(song_id){return getMp3Url(song(song_id))};var search=function search(){var name=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var onlySong=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var limit=arguments.length>3&&arguments[3]!==undefined?arguments[3]:3;var offset=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var option=(0,_util.deepCopy)(_config.globalOption);var url=_config.origin+'/api/search/suggest/web';var body=_querystring2.default.stringify({s:name,type:type,limit:limit,offset:offset});Object.assign(option,{body:body});var info=(0,_util.requestPost)(url,option);var data=void 0;if(onlySong){data=info.result.songs}else{data={songs:info.result.songs,mvs:info.result.mvs}}return data};var lrc=function lrc(id){var lv=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;var option=(0,_util.deepCopy)(_config.globalOption);var url=_config.origin+'/api/song/lyric?lv='+lv+'&id='+id;var l=(0,_util.requestGet)(url,option);return l.hasOwnProperty('lrc')?l.lrc.lyric:'no lyric'};var playLists=function playLists(id){var option=(0,_util.deepCopy)(_config.globalOption);var url=_config.origin+'/api/playlist/detail?id='+id;return(0,_util.requestGet)(url,option).result};var artistAlbums=function artistAlbums(id){var limit=arguments.length>1&&arguments[1]!==undefined?arguments[1]:3;var offset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var option=(0,_util.deepCopy)(_config.globalOption);var url=_config.origin+'/api/artist/albums/'+id+'?offset='+offset+'&limit='+limit;return(0,_util.requestGet)(url,option)};var albums=function albums(id){var option=(0,_util.deepCopy)(_config.globalOption);var url=_config.origin+'/api/album/'+id;return(0,_util.requestGet)(url,option).album};exports.default={getTopListNames:getTopListNames,getTopSongList:getTopSongList,song:song,getMp3Url:getMp3Url,getMp3UrlById:getMp3UrlById,search:search,lrc:lrc,playLists:playLists,artistAlbums:artistAlbums,albums:albums};