'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _parseFloat=require('babel-runtime/core-js/number/parse-float');var _parseFloat2=_interopRequireDefault(_parseFloat);var _slicedToArray2=require('babel-runtime/helpers/slicedToArray');var _slicedToArray3=_interopRequireDefault(_slicedToArray2);var _getPrototypeOf=require('babel-runtime/core-js/object/get-prototype-of');var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require('babel-runtime/helpers/createClass');var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require('babel-runtime/helpers/possibleConstructorReturn');var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require('babel-runtime/helpers/inherits');var _inherits3=_interopRequireDefault(_inherits2);var _events=require('events');var _events2=_interopRequireDefault(_events);var _mpg=require('mpg123');var _mpg2=_interopRequireDefault(_mpg);var _api=require('./api');var _api2=_interopRequireDefault(_api);var _util=require('./util');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Player=function(_EventEmitter){(0,_inherits3.default)(Player,_EventEmitter);function Player(){(0,_classCallCheck3.default)(this,Player);var _this=(0,_possibleConstructorReturn3.default)(this,(Player.__proto__||(0,_getPrototypeOf2.default)(Player)).call(this));_this.player=new _mpg2.default;_this._list=[];_this._ll=_this._list.length;_this._index=0;return _this}(0,_createClass3.default)(Player,[{key:'setPlayList',value:function setPlayList(song_id_list){this._list=song_id_list instanceof Array?song_id_list:[];this._ll=this._list.length}},{key:'play',value:function play(){var _this2=this;var index=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;if(this._ll<1||typeof index!=='number'||index<0){return this}this._index=index;this._next=(this._index+1)%this._ll;this.emit('playing',this._index);var url=_api2.default.getSongUrl(this._list[index]);if(!url)url=_api2.default.getMp3UrlById(this._list[index]);try{this.player.play(url)}catch(e){this.play(this._next)}this.player.removeAllListeners('end');this.player.once('end',function(){_this2.play(_this2._next)});this.player.removeAllListeners('frame');this.player.on('frame',function(d){var _d=(0,_slicedToArray3.default)(d,4),c_num=_d[0],r_num=_d[1],c_time=_d[2],r_time=_d[3];c_time=(0,_parseFloat2.default)(c_time);r_time=(0,_parseFloat2.default)(r_time);var t_time=c_time+r_time;var percent=Math.round(c_time/t_time*10000)/100;var current_time=(0,_util.toMMSS)(c_time);var total_time=(0,_util.toMMSS)(t_time);_this2.emit('processing',percent,current_time,total_time)})}},{key:'pause',value:function pause(){this.player.pause()}}]);return Player}(_events2.default);exports.default=Player;